<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Print Patient Record ‚Äî {{ patient.full_name }}</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { font-family: 'Segoe UI', sans-serif; background: #fff; color: #000; }
h4, h5 { color: #0d6efd; font-weight: 600; }
.text-success { color: #28a745 !important; }
.text-danger { color: #dc3545 !important; }
.table th, .table td { vertical-align: middle !important; }
@media print {
    .no-print { display: none; }
    body { background: #fff; }
    .table { border: 1px solid #000; }
}
</style>
</head>
<body class="p-4">

<!-- Header + Controls -->
<div class="no-print mb-3 d-flex justify-content-between align-items-center">
    <a href="{{ url_for('view_patient', patient_id=patient.id) }}" class="btn btn-secondary">‚¨Ö Back to Patient</a>
    <a href="{{ url_for('dashboard_main') }}" class="btn btn-outline-secondary">üè† Dashboard</a>
    <button onclick="window.print()" class="btn btn-primary">üñ®Ô∏è Print</button>
</div>

<h4>ü¶∑ Patient Record Summary ‚Äî The Dental Edit</h4>
<hr>

{% macro yes_no_icon(value) %}
    {% if value == 'Yes' %}
        <span class="text-success fw-bold">‚úì Yes</span>
    {% else %}
        <span class="text-danger fw-bold">‚úó No</span>
    {% endif %}
{% endmacro %}

<!-- 1Ô∏è‚É£ Patient Info -->
<h5>1Ô∏è‚É£ Patient Information</h5>
<table class="table table-bordered">
<tbody>
<tr><th>Full Name</th><td>{{ patient.full_name }}</td><th>File No</th><td>{{ patient.file_no }}</td></tr>
<tr><th>Gender</th><td>{{ patient.gender }}</td><th>Contact</th><td>{{ patient.contact }}</td></tr>
<tr><th>Address</th><td colspan="3">{{ patient.address or '-' }}</td></tr>
<tr><th>Created On</th><td>{{ patient.date }}</td><th>Created By</th><td>{{ patient.created_by }}</td></tr>
</tbody></table>

<!-- 2Ô∏è‚É£ Medical History -->
<h5>2Ô∏è‚É£ Medical History</h5>
<table class="table table-bordered">
<tbody>
<tr><th>Heart Disease</th><td>{{ yes_no_icon(patient.heart_disease) }}</td><th>Blood Pressure</th><td>{{ yes_no_icon(patient.blood_pressure) }}</td></tr>
<tr><th>Diabetes</th><td>{{ yes_no_icon(patient.diabetes) }}</td><th>Asthma</th><td>{{ yes_no_icon(patient.asthma) }}</td></tr>
<tr><th>Tuberculosis</th><td>{{ yes_no_icon(patient.tuberculosis) }}</td><th>Hepatitis</th><td>{{ yes_no_icon(patient.hepatitis) }}</td></tr>
<tr><th>Bleeding Disorder</th><td>{{ yes_no_icon(patient.bleeding_disorder) }}</td><th>Epilepsy</th><td>{{ yes_no_icon(patient.epilepsy) }}</td></tr>
<tr><th>Thyroid Disorder</th><td>{{ yes_no_icon(patient.thyroid_disorder) }}</td><th>Kidney Disease</th><td>{{ yes_no_icon(patient.kidney_disease) }}</td></tr>
<tr><th>Stomach Ulcers</th><td>{{ yes_no_icon(patient.stomach_ulcers) }}</td><th>Psychiatric Disorder</th><td>{{ yes_no_icon(patient.psychiatric_disorder) }}</td></tr>
<tr><th>Medications</th><td colspan="3">{{ patient.medications or '-' }}</td></tr>
<tr><th>Allergies</th><td colspan="3">{{ patient.allergies or '-' }}</td></tr>
<tr><th>Other Health Issues</th><td colspan="3">{{ patient.other_health or '-' }}</td></tr>
</tbody></table>

<!-- 3Ô∏è‚É£ Dental History -->
<h5>3Ô∏è‚É£ Dental History</h5>
<table class="table table-bordered">
<tbody>
<tr><th>Previous Treatment</th><td>{{ patient.dental_treatment_before or '-' }}</td><th>Last Visit</th><td>{{ patient.last_dental_visit or '-' }}</td></tr>
<tr><th>Previous Dentist</th><td>{{ patient.previous_dentist or '-' }}</td><th>Gum Problem</th><td>{{ patient.gum_problem or '-' }}</td></tr>
<tr><th>Teeth Grinding</th><td>{{ patient.teeth_grinding or '-' }}</td><th>Smoking</th><td>{{ patient.smoking or '-' }}</td></tr>
<tr><th>Smoking Frequency</th><td colspan="3">{{ patient.smoking_frequency or '-' }}</td></tr>
<tr><th>Chief Complaint</th><td colspan="3">{{ patient.chief_complaint or '-' }}</td></tr>
</tbody></table>

<!-- 4Ô∏è‚É£ Treatment & Payment -->
<h5>4Ô∏è‚É£ Treatments & Payments</h5>
<div class="alert alert-info fw-bold">
üí∞ Total Fee: Rs. {{ total_fee }} | ‚úÖ Paid: Rs. {{ total_paid }} | ‚öñÔ∏è Remaining: Rs. {{ remaining }}
</div>

<table class="table table-bordered table-hover">
<thead class="table-light">
<tr>
  <th>Date</th>
  <th>Treatment Type</th>
  <th>Tooth</th>
  <th>Dentist</th>
  <th>Notes</th>
  <th>Fee (Rs.)</th>
  <th>Attachment</th>
</tr>
</thead>
<tbody>
{% for t in treatments %}
<tr>
  <td>{{ t.date }}</td>
  <td>{{ t.treatment_type }}</td>
  <td>{{ t.tooth_number or '-' }}</td>
  <td>{{ t.dentist.name if t.dentist else t.doctor }}</td>
  <td style="white-space: pre-wrap;">{{ t.notes or '-' }}</td>
  <td>{{ t.amount }}</td>
  <td>
    {% if t.related_files %}
      {% for f in t.related_files %}
        <a href="{{ url_for('uploaded_file', filename=f.filename) }}" target="_blank">View</a><br>
      {% endfor %}
    {% else %}
      -
    {% endif %}
  </td>
</tr>
{% else %}
<tr><td colspan="7" class="text-center text-muted">No treatments recorded.</td></tr>
{% endfor %}
</tbody>
</table>

<hr>
<div class="text-center text-muted small mt-3">
  Printed from The Dental Edit ‚Äî {{ datetime.utcnow().strftime("%Y-%m-%d %H:%M") }}
</div>

</body>
</html>
