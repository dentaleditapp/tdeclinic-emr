{% extends "layout.html" %}
{% block content %}
<div class="container py-4">

  <h4 class="text-primary mb-3">âž• New Visit â€” {{ patient.full_name }}</h4>

  <form method="POST" enctype="multipart/form-data" class="card shadow-sm p-3">
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label fw-bold">Visit Date</label>
        <input type="date" name="visit_date" class="form-control"
               value="{{ request.form.get('visit_date') or '' }}">
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">Dentist</label>
        <select name="dentist_id" class="form-select" required>
          <option value="">-- Select Dentist --</option>
          {% for d in dentists %}
          <option value="{{ d.id }}">{{ d.name }}{% if d.specialization %} â€” {{ d.specialization }}{% endif %}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">BP (optional)</label>
        <input type="text" name="bp" class="form-control" placeholder="120/80">
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Chief Complaint</label>
      <textarea name="chief_complaint" class="form-control" rows="2"
                placeholder="Main reason for visit"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Acute Issue / Emergency</label>
      <textarea name="acute_issue" class="form-control" rows="2"
                placeholder="Swelling, trauma, severe pain, etc."></textarea>
    </div>

    <!-- Dynamic reproductive info (per visit, not permanent) -->
    <div class="row mb-3">
      <div class="col-md-4">
        <label class="form-label fw-bold">Pregnant</label>
        <select name="pregnant" class="form-select">
          <option value="">Not applicable</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">Weeks of Pregnancy</label>
        <input type="text" name="pregnancy_weeks" class="form-control" placeholder="e.g., 20 weeks">
      </div>
      <div class="col-md-4">
        <label class="form-label fw-bold">Breastfeeding</label>
        <select name="breastfeeding" class="form-select">
          <option value="">Not applicable</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>
      </div>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Visit Notes</label>
      <textarea name="visit_notes" class="form-control" rows="3"
                placeholder="Any important extra info before treatment"></textarea>
    </div>

    <div class="mb-3">
      <label class="form-label fw-bold">Attachment (optional)</label>
      <input type="file" name="attachment" class="form-control"
             accept=".png,.jpg,.jpeg,.pdf">
      <div class="form-text">You can attach a photo, X-ray or report for this visit.</div>
    </div>

    <div class="d-flex justify-content-between">
      <a href="{{ url_for('view_patient', patient_id=patient.id) }}" class="btn btn-secondary">â¬… Back</a>
      <button type="submit" class="btn btn-success">ðŸ’¾ Save Visit</button>
    </div>
  </form>

</div>
{% endblock %}
